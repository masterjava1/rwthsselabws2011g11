<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>SSELAB TippeTop gyro group11: Odeint.h Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo"><img alt="Logo" src="logo.jpg"/></td>
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">SSELAB TippeTop gyro group11
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">Integration toolkit to solve the TippeTop Problem</div>
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">Odeint.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_odeint_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#ifndef _ODEINT_INCLUDED__</span>
<a name="l00002"></a>00002 <span class="preprocessor"></span><span class="preprocessor">#define _ODEINT_INCLUDED__</span>
<a name="l00003"></a>00003 <span class="preprocessor"></span>
<a name="l00004"></a><a class="code" href="_odeint_8h.html#ac89d5f8a358eb8a1abdcd0fcef134f1a">00004</a> <span class="preprocessor">#define SIGN(a,b) ((b) &gt;= 0.0 ? fabs(a) : -fabs(a))</span>
<a name="l00005"></a>00005 <span class="preprocessor"></span>
<a name="l00006"></a>00006 <span class="preprocessor">#include &lt;blitz/array.h&gt;</span>
<a name="l00007"></a>00007 <span class="preprocessor">#include &lt;NTL/RR.h&gt;</span>
<a name="l00008"></a>00008 <span class="preprocessor">#include &quot;<a class="code" href="_output_8h.html">Output.h</a>&quot;</span>
<a name="l00009"></a>00009 
<a name="l00010"></a>00010 <span class="keyword">using namespace </span>blitz;
<a name="l00011"></a>00011 <span class="keyword">using namespace </span>NTL;
<a name="l00012"></a>00012 
<a name="l00014"></a>00014 
<a name="l00030"></a>00030 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> Stepper&gt;
<a name="l00031"></a><a class="code" href="class_odeint.html">00031</a> <span class="keyword">class </span><a class="code" href="class_odeint.html" title="high-level interface for ODE solvers with adaptive steppsize controll">Odeint</a> {
<a name="l00032"></a>00032    <span class="keyword">public</span>:
<a name="l00033"></a><a class="code" href="class_odeint.html#a3211a7c8113b20175baa56c87a49c37a">00033</a>    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> MAXSTP=5000000;  <span class="comment">// Maxsteps</span>
<a name="l00034"></a><a class="code" href="class_odeint.html#a22958a5c7e2543e7704eb980518975a2">00034</a>    RR <a class="code" href="class_odeint.html#a22958a5c7e2543e7704eb980518975a2">EPS</a>;
<a name="l00035"></a><a class="code" href="class_odeint.html#ae8d37e6197126266dbeff26f6cb61085">00035</a>    <span class="keywordtype">int</span> <a class="code" href="class_odeint.html#ae8d37e6197126266dbeff26f6cb61085">nok</a>; <span class="comment">// good steps</span>
<a name="l00036"></a><a class="code" href="class_odeint.html#aa8584b567b3eb31887d46d306a46389d">00036</a>    <span class="keywordtype">int</span> <a class="code" href="class_odeint.html#aa8584b567b3eb31887d46d306a46389d">nbad</a>; <span class="comment">// bad steps (retried and fixed)</span>
<a name="l00037"></a><a class="code" href="class_odeint.html#a53a819f87823379003ed61c471519d2b">00037</a>    <span class="keywordtype">int</span> <a class="code" href="class_odeint.html#a53a819f87823379003ed61c471519d2b">nvar</a>;
<a name="l00038"></a><a class="code" href="class_odeint.html#a2395b4ee2faf735219638f7385927097">00038</a>    RR x1, <a class="code" href="class_odeint.html#a2395b4ee2faf735219638f7385927097">x2</a>, hmin;
<a name="l00039"></a><a class="code" href="class_odeint.html#af201992452293fa974f34e57c63d5b16">00039</a>    <span class="keywordtype">bool</span> <a class="code" href="class_odeint.html#af201992452293fa974f34e57c63d5b16">dense</a>;  <span class="comment">// true if dense output is requested by out</span>
<a name="l00040"></a><a class="code" href="class_odeint.html#a1bfc74e3d8760b9d6e7c7ba26bc33f4a">00040</a>    Array&lt;RR,1&gt; <a class="code" href="class_odeint.html#a1bfc74e3d8760b9d6e7c7ba26bc33f4a">y</a>;
<a name="l00041"></a><a class="code" href="class_odeint.html#ada60d5233e41dc7412082e8914c694b3">00041</a>    Array&lt;RR,1&gt; <a class="code" href="class_odeint.html#ada60d5233e41dc7412082e8914c694b3">dydx</a>;
<a name="l00042"></a><a class="code" href="class_odeint.html#a9f2cdfed6f39651e11f2f81a79459926">00042</a>    Array&lt;RR,1&gt; &amp;<a class="code" href="class_odeint.html#a9f2cdfed6f39651e11f2f81a79459926">ystart</a>;
<a name="l00043"></a><a class="code" href="class_odeint.html#a67e729855849613d5b764d8efaa21b1d">00043</a>    <a class="code" href="class_output.html" title="structure for output from ODE solver such as odeint">Output&lt;Stepper&gt;</a> &amp;<a class="code" href="class_odeint.html#a67e729855849613d5b764d8efaa21b1d">out</a>;
<a name="l00044"></a><a class="code" href="class_odeint.html#aa6dbbbcd2b973aca19e8f4f14ba49894">00044</a>    <span class="keyword">typename</span> Stepper::Dtype &amp;<a class="code" href="class_odeint.html#aa6dbbbcd2b973aca19e8f4f14ba49894">derivs</a>;  <span class="comment">// get the type of derivs from the stepper</span>
<a name="l00045"></a><a class="code" href="class_odeint.html#a2d89719de8c96f75b3e0dc6912a49d09">00045</a>    Stepper <a class="code" href="class_odeint.html#a2d89719de8c96f75b3e0dc6912a49d09">s</a>;
<a name="l00046"></a><a class="code" href="class_odeint.html#ab14c7698c9e19035c6cf56e013469a88">00046</a>    <span class="keywordtype">int</span> <a class="code" href="class_odeint.html#ab14c7698c9e19035c6cf56e013469a88">nstp</a>;
<a name="l00047"></a><a class="code" href="class_odeint.html#ab371f03224559ac34af4a5e66fabf22a">00047</a>    RR <a class="code" href="class_odeint.html#ab371f03224559ac34af4a5e66fabf22a">x</a>,h;
<a name="l00048"></a>00048    <span class="comment">// The routines integrates starting values ystart[0..nvar-1] from xx1 to xx2 with </span>
<a name="l00049"></a>00049    <span class="comment">// absolute tolerance atol and relative tolerance rtol. The quantity h1 should be</span>
<a name="l00050"></a>00050    <span class="comment">// set as guessed first stepsize, hmin as the minimum allowed stepsize </span>
<a name="l00051"></a>00051    <span class="comment">// (can be zero). An Output object should be input to control the saving of </span>
<a name="l00052"></a>00052    <span class="comment">// intermediate values. derivs is the supplied RHS. </span>
<a name="l00053"></a>00053    <a class="code" href="class_odeint.html" title="high-level interface for ODE solvers with adaptive steppsize controll">Odeint</a>(Array&lt;RR,1&gt; &amp;ystartt, <span class="keyword">const</span> RR xx1, <span class="keyword">const</span> RR xx2,
<a name="l00054"></a>00054     <span class="keyword">const</span> RR atol, <span class="keyword">const</span> RR rtol, <span class="keyword">const</span> RR h1, <span class="keyword">const</span> RR hminn, 
<a name="l00055"></a>00055     <a class="code" href="class_output.html" title="structure for output from ODE solver such as odeint">Output&lt;Stepper&gt;</a> &amp;outt, <span class="keyword">typename</span> Stepper::Dtype &amp;derivss);
<a name="l00056"></a>00056    <span class="comment">// Does actual integration</span>
<a name="l00057"></a>00057    <span class="keywordtype">void</span> integrate();
<a name="l00058"></a>00058 };
<a name="l00059"></a>00059 
<a name="l00060"></a>00060 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> Stepper&gt;
<a name="l00061"></a><a class="code" href="class_odeint.html#a7beba4948cc41896bb53bf32397da346">00061</a> <a class="code" href="class_odeint.html" title="high-level interface for ODE solvers with adaptive steppsize controll">Odeint&lt;Stepper&gt;::Odeint</a>(Array&lt;RR,1&gt; &amp;ystartt, <span class="keyword">const</span> RR xx1, <span class="keyword">const</span> RR xx2,
<a name="l00062"></a>00062  <span class="keyword">const</span> RR atol, <span class="keyword">const</span> RR rtol, <span class="keyword">const</span> RR h1, <span class="keyword">const</span> RR hminn, 
<a name="l00063"></a>00063  <a class="code" href="class_output.html" title="structure for output from ODE solver such as odeint">Output&lt;Stepper&gt;</a> &amp;outt, <span class="keyword">typename</span> Stepper::Dtype &amp;derivss) 
<a name="l00064"></a>00064  : nvar(ystartt.size()), y(nvar), dydx(nvar), ystart(ystartt), x(xx1), nok(0), 
<a name="l00065"></a>00065  nbad(0), x1(xx1), x2(xx2), hmin(hminn), dense(outt.dense), out(outt), 
<a name="l00066"></a>00066  s(y, dydx, x, atol, rtol, dense), derivs(derivss) {
<a name="l00067"></a>00067    <a class="code" href="class_odeint.html#a22958a5c7e2543e7704eb980518975a2">EPS</a>=to_RR(2.4651903288156618919116517665087069677288E-32);
<a name="l00068"></a>00068    <a class="code" href="class_odeint.html#ac95d532494f8101072597d379f8eee60">h</a>=<a class="code" href="_odeint_8h.html#ac89d5f8a358eb8a1abdcd0fcef134f1a">SIGN</a>(h1, <a class="code" href="class_odeint.html#a2395b4ee2faf735219638f7385927097">x2</a>-<a class="code" href="class_odeint.html#aab0aeb2b71c071e51d0a76409f7438d9">x1</a>);
<a name="l00069"></a>00069    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;<a class="code" href="class_odeint.html#a53a819f87823379003ed61c471519d2b">nvar</a>;i++) <a class="code" href="class_odeint.html#a1bfc74e3d8760b9d6e7c7ba26bc33f4a">y</a>(i)=<a class="code" href="class_odeint.html#a9f2cdfed6f39651e11f2f81a79459926">ystart</a>(i);
<a name="l00070"></a>00070    <a class="code" href="class_odeint.html#a67e729855849613d5b764d8efaa21b1d">out</a>.init(<a class="code" href="class_odeint.html#a2d89719de8c96f75b3e0dc6912a49d09">s</a>.neqn,<a class="code" href="class_odeint.html#aab0aeb2b71c071e51d0a76409f7438d9">x1</a>,<a class="code" href="class_odeint.html#a2395b4ee2faf735219638f7385927097">x2</a>);
<a name="l00071"></a>00071 }
<a name="l00072"></a>00072 
<a name="l00073"></a>00073 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> Stepper&gt;
<a name="l00074"></a><a class="code" href="class_odeint.html#a998c158bc0c3e531cd5b1960cddfa3d0">00074</a> <span class="keywordtype">void</span> <a class="code" href="class_odeint.html#a998c158bc0c3e531cd5b1960cddfa3d0">Odeint&lt;Stepper&gt;::integrate</a>() {
<a name="l00075"></a>00075    derivs(x,y,dydx);
<a name="l00076"></a>00076    <span class="keywordflow">if</span>(dense){   <span class="comment">// Store initial values</span>
<a name="l00077"></a>00077       out.out(-1,x,y,s,h);
<a name="l00078"></a>00078    }
<a name="l00079"></a>00079    <span class="keywordflow">else</span>{
<a name="l00080"></a>00080       out.save(x,y);
<a name="l00081"></a>00081    }
<a name="l00082"></a>00082    <span class="keywordflow">for</span> (nstp=0;nstp&lt;MAXSTP;nstp++) {
<a name="l00083"></a>00083       <span class="keywordflow">if</span> ((x+h*1.0001-x2)*(x2-x1) &gt; 0.0) {
<a name="l00084"></a>00084          h=x2-x;  <span class="comment">// If stepsize can overshot, decrease</span>
<a name="l00085"></a>00085       }
<a name="l00086"></a>00086       s.step(h,derivs);  <span class="comment">// Take a step</span>
<a name="l00087"></a>00087       <span class="keywordflow">if</span> (s.hdid == h) ++nok; <span class="keywordflow">else</span> ++nbad;
<a name="l00088"></a>00088       <span class="keywordflow">if</span> (dense) {
<a name="l00089"></a>00089          out.out(nstp,x,y,s,s.hdid);
<a name="l00090"></a>00090       }<span class="keywordflow">else</span> {
<a name="l00091"></a>00091          out.save(x,y);
<a name="l00092"></a>00092       }
<a name="l00093"></a>00093       <span class="keywordflow">if</span> ((x-x2)*(x2-x1) &gt;= 0.0) {  <span class="comment">// Are we done?</span>
<a name="l00094"></a>00094          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;nvar;i++) ystart(i)=y(i);  <span class="comment">// Update ystart</span>
<a name="l00095"></a>00095          <span class="keywordflow">if</span> (out.kmax&gt;0 &amp;&amp; abs(out.xsave(out.count-1)-x2)&gt;100.0*abs(x2)*EPS){
<a name="l00096"></a>00096             out.save(x,y);  <span class="comment">// Make sure last step gets saved</span>
<a name="l00097"></a>00097          }
<a name="l00098"></a>00098          <span class="keywordflow">return</span>;  <span class="comment">// Normal exit</span>
<a name="l00099"></a>00099       }
<a name="l00100"></a>00100       <span class="keywordflow">if</span> (abs(s.hnext) &lt;= hmin) <span class="keywordflow">throw</span>(<a class="code" href="class_runtime_exception.html" title="Default exception class.">RuntimeException</a>(<span class="stringliteral">&quot;Step size too small in Odeint!\n&quot;</span>
<a name="l00101"></a>00101       <span class="stringliteral">&quot;hnext &lt;= hmin&quot;</span>,0));
<a name="l00102"></a>00102       h=s.hnext;
<a name="l00103"></a>00103    }
<a name="l00104"></a>00104    <span class="keywordflow">throw</span>(<a class="code" href="class_runtime_exception.html" title="Default exception class.">RuntimeException</a>(<span class="stringliteral">&quot;Too many steps in routine Odeint\n&quot;</span>
<a name="l00105"></a>00105    <span class="stringliteral">&quot;counter &gt; maxsteps&quot;</span>,0));
<a name="l00106"></a>00106 }
<a name="l00107"></a>00107 
<a name="l00108"></a>00108 <span class="preprocessor">#endif</span>
</pre></div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Thu Apr 12 2012 16:51:09 for SSELAB TippeTop gyro group11 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
